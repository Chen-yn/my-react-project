# This workflow will do a clean install of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: Node.js CI

on:
  push: # åœ¨æ¨é€çš„æ—¶å€™è¿è¡Œæ­¤action
    branches: [ main ] # æŒ‡å®šåˆ†æ”¯
  pull_request:
    branches: [ main ]

jobs:
  build:

    runs-on: ubuntu-latest # è¿è¡Œç¯å¢ƒ

    strategy:
      matrix:
        node-version: [16.x] # è¿™é‡ŒæŒ‡å®šnodeç‰ˆæœ¬
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/

    steps:
    - uses: actions/checkout@v2 # è¿™é‡Œä½¿ç”¨äº†githubå®˜æ–¹æä¾›çš„action,checkouté¡¹ç›®åˆ°è™šæ‹Ÿæœºä¸Š
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v2
      with:
        node-version: ${{ matrix.node-version }}
    - name: ğŸ”¨ Build Project 
      run: | # æ‰“åŒ…æ„å»ºé¡¹ç›®ä»£ç 
        npm install --legacy-peer-deps
        npm run build:prod
    - name: FTP-Deploy-Action
      uses: SamKirkland/FTP-Deploy-Action@2.0.0 # ä½¿ç”¨çš„sftpæ’ä»¶ï¼Œå°†é¡¹ç›®ä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿™é‡Œä½¿ç”¨2.0ç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆæœ¬4.0ä¸æ”¯æŒsftp
      env:
        FTP_SERVER: ${{ secrets.SERVER_IP_1 }} # ä½ çš„nginxæœåŠ¡å™¨å…¬ç½‘ip
        FTP_USERNAME: ${{ secrets.USERNAME_1 }} # ä½ çš„nginxæœåŠ¡å™¨ç”¨æˆ·å
        FTP_PASSWORD: ${{ secrets.PASSWORD_1 }} # ä½ çš„nginxæœåŠ¡å™¨å¯†ç 
        LOCAL_DIR: ./build/ # ä½ reacté¡¹ç›®buildå¥½çš„æ–‡ä»¶çš„è·¯å¾„,æ¯æ¬¡æœåŠ¡å™¨ä¸Šä¼šè‡ªåŠ¨åˆ é™¤å¯¹åº”çš„æ–‡ä»¶å¤¹åé‡æ–°è¦†ç›–
        REMOTE_DIR: ${{ secrets.SERVER_DESTINATION_1 }} # ä½ è¦æŠŠä½ buildå¥½çš„æ–‡ä»¶å¤¹æ”¾åˆ°nginxæœåŠ¡å™¨ä¸Šçš„ä»€ä¹ˆä½ç½®
        METHOD: sftp # æŒ‡å®šæœåŠ¡ä¸ºsftp
        PORT: ${{ secrets.SERVER_PORT_1 }} # ä½ çš„nginxæœåŠ¡å™¨sshç«¯å£
